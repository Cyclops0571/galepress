(function(d){d.Jcrop=function(x,s){function e(a){return""+parseInt(a)+"px"}function O(a){a=d(a).offset();return[a.left,a.top]}function A(a){return[a.pageX-M[0],a.pageY-M[1]]}function ea(a,o){return function(n){if(b.aspectRatio)switch(a){case "e":n[1]=o.y+1;break;case "w":n[1]=o.y+1;break;case "n":n[0]=o.x+1;break;case "s":n[0]=o.x+1}else switch(a){case "e":n[1]=o.y2;break;case "w":n[1]=o.y2;break;case "n":n[0]=o.x2;break;case "s":n[0]=o.x2}j.setCurrent(n);k.update()}}function fa(a){var b=a;P.watchKeys();
return function(a){j.moveOffset([a[0]-b[0],a[1]-b[1]]);b=a;k.update()}}function V(a){switch(a){case "n":return"sw";case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function W(a){return function(o){if(b.disabled)return!1;if(a=="move"&&!b.allowMove)return!1;G=!0;var n=A(o);M=O(t);z.setCursor(a=="move"?a:a+"-resize");if(a=="move")z.activateHandlers(fa(n),Q);else{var n=j.getFixed(),d=V(a),c=j.getCorner(V(d));
j.setPressed(j.getCorner(d));j.setCurrent(c);z.activateHandlers(ea(a,n),Q)}o.stopPropagation();o.preventDefault();return!1}}function R(a){var o=null;return o=b.keepRatio?{x:E(parseInt(a.x*u)),y:E(parseInt(a.y*v)),x2:E(parseInt(a.x2*u)),y2:E(parseInt(a.y2*v)),w:E(parseInt(a.w*u)),h:E(parseInt(a.h*v)),wo:origImageWidth,ho:origImageHeight}:{x:parseInt(a.x*u),y:parseInt(a.y*v),x2:parseInt(a.x2*u),y2:parseInt(a.y2*v),w:parseInt(a.w*u),h:parseInt(a.h*v),wo:origImageWidth,ho:origImageHeight}}function Q(){var a=
j.getFixed();a.w>b.minSelect[0]&&a.h>b.minSelect[1]?(k.enableHandles(),k.done()):k.release();z.setCursor(b.allowSelect?"crosshair":"default")}function ga(a){j.setCurrent(a);k.update()}function X(){var a=d("<div></div>").addClass(b.baseClass+"-tracker");d.browser.msie&&a.css({opacity:0,backgroundColor:"white"});return a}function Y(a){Z([a[0]/u,a[1]/v,a[2]/u,a[3]/v])}function Z(a){j.setPressed([a[0],a[1]]);j.setCurrent([a[2],a[3]]);k.update()}function $(a){typeof a!="object"&&(a={});b=d.extend(b,a);
if(typeof b.onChange!=="function")b.onChange=function(){};if(typeof b.onSelect!=="function")b.onSelect=function(){}}function S(a){b.allowResize?a?k.enableOnly():k.enableHandles():k.disableHandles();z.setCursor(b.allowSelect?"crosshair":"default");k.setCursor(b.allowMove?"move":"default");T.css("backgroundColor",b.bgColor);"setSelect"in b&&(Y(s.setSelect),k.done(),delete b.setSelect);"trueSize"in b&&(u=b.trueSize[0]/l,v=b.trueSize[1]/q);H=b.maxSize[0]||0;I=b.maxSize[1]||0;J=b.minSize[0]||0;K=b.minSize[1]||
0;"outerImage"in b&&(t.attr("src",b.outerImage),delete b.outerImage);k.refresh()}typeof x!=="object"&&(x=d(x)[0]);typeof s!=="object"&&(s={});if(!("trackDocument"in s)&&(s.trackDocument=d.browser.msie?!1:!0,d.browser.msie&&d.browser.version.split(".")[0]=="8"))s.trackDocument=!0;if(!("keySupport"in s))s.keySupport=d.browser.msie?!1:!0;var b={trackDocument:!1,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,borderOpacity:0.4,handleOpacity:0.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,
aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:!0,allowMove:!0,allowResize:!0,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},keepRatio:!1};$(s);var C=d(x),t=C.clone().removeAttr("id").css({position:"absolute"});t.width(C.width());t.height(C.height());C.after(t).hide();(function(a,b,d){var y=a.width(),c=a.height();y>b&&b>0&&(y=b,c=b/a.width()*
a.height());c>d&&d>0&&(c=d,y=d/a.height()*a.width());u=a.width()/y;v=a.height()/c;a.width(y).height(c)})(t,b.boxWidth,b.boxHeight);var l=t.width(),q=t.height(),T=d("<div />").width(l).height(q).addClass(b.baseClass+"-holder").css({position:"relative",backgroundColor:b.bgColor}).insertAfter(C).append(t);b.addClass&&T.addClass(b.addClass);var aa=d("<img />").attr("src",t.attr("src")).css("position","absolute").width(l).height(q),U=d("<div />").width(""+parseInt(100)+"%").height(""+parseInt(100)+"%").css({zIndex:310,
position:"absolute",overflow:"hidden"}).append(aa),F=d("<div />").width(""+parseInt(100)+"%").height(""+parseInt(100)+"%").css("zIndex",320),N=d("<div />").css({position:"absolute",zIndex:300}).insertBefore(t).append(U,F),D=b.boundary,L=X().width(l+D*2).height(q+D*2).css({position:"absolute",top:e(-D),left:e(-D),zIndex:290}).mousedown(function(a){if(b.disabled)return!1;if(!b.allowSelect)return!1;G=!0;M=O(t);k.disableHandles();"crosshair"!=ba&&(z.setCursor("crosshair"),ba="crosshair");var d=A(a);j.setPressed(d);
z.activateHandlers(ga,Q);P.watchKeys();k.update();a.stopPropagation();a.preventDefault();return!1}),H,I,J,K,u,v,M=O(t),G,ba,ca,ha,da=1;origImageSrc=d(x).attr("src");d("#get-image-size").length==0?d(document.createElement("img")).attr({src:origImageSrc,id:"get-image-size"}).addClass("hidden-image").appendTo("body"):d("#get-image-size").attr("src",origImageSrc);origImageWidth=d("#get-image-size").width();origImageHeight=d("#get-image-size").height();var da=origImageWidth/d("#cropbox").width(),E=function(a){return Math.round(a*
da)},j=function(){function a(){if(!b.aspectRatio){var a=e-c,d=p-f;H&&Math.abs(a)>H&&(e=a>0?c+H:c-H);I&&Math.abs(d)>I&&(p=d>0?f+I:f-I);K&&Math.abs(d)<K&&(p=d>0?f+K:f-K);J&&Math.abs(a)<J&&(e=a>0?c+J:c-J);c<0&&(e-=c,c-=c);f<0&&(p-=f,f-=f);e<0&&(c-=e,e-=e);p<0&&(f-=p,p-=p);e>l&&(a=e-l,c-=a,e-=a);p>q&&(a=p-q,f-=a,p-=a);c>l&&(a=c-q,p-=a,f-=a);f>q&&(a=f-q,p-=a,f-=a);return y(n(c,f,e,p))}var a=b.aspectRatio,d=b.minSize[0]/u,o=b.maxSize[0]/u,j=e-c,r=p-f,m=Math.abs(j),g=Math.abs(r);o==0&&(o=l*10);m/g<a?(m=
p,w=g*a,g=j<0?c-w:w+c,g<0?(g=0,h=Math.abs((g-c)/a),m=r<0?f-h:h+f):g>l&&(g=l,h=Math.abs((g-c)/a),m=r<0?f-h:h+f)):(g=e,h=m/a,m=r<0?f-h:f+h,m<0?(m=0,w=Math.abs((m-f)*a),g=j<0?c-w:w+c):m>q&&(m=q,w=Math.abs(m-f)*a,g=j<0?c-w:w+c));g>c?(g-c<d?g=c+d:g-c>o&&(g=c+o),m=m>f?f+(g-c)/a:f-(g-c)/a):g<c&&(c-g<d?g=c-d:c-g>o&&(g=c-o),m=m>f?f+(c-g)/a:f-(c-g)/a);g<0?(c-=g,g=0):g>l&&(c-=g-l,g=l);m<0?(f-=m,m=0):m>q&&(f-=m-q,m=q);return last=y(n(c,f,g,m))}function d(a){a[0]<0&&(a[0]=0);a[1]<0&&(a[1]=0);a[0]>l&&(a[0]=l);
a[1]>q&&(a[1]=q);return[a[0],a[1]]}function n(a,c,b,d){var f=a,e=b,g=c,o=d;b<a&&(f=b,e=a);d<c&&(g=d,o=c);return[Math.round(f),Math.round(g),Math.round(e),Math.round(o)]}function y(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var c=0,f=0,e=0,p=0,j,k;return{flipCoords:n,setPressed:function(a){a=d(a);e=c=a[0];p=f=a[1]},setCurrent:function(a){a=d(a);j=a[0]-e;k=a[1]-p;e=a[0];p=a[1]},getOffset:function(){return[j,k]},moveOffset:function(a){var b=a[0],a=a[1];0>c+b&&(b-=b+c);0>f+a&&(a-=
a+f);q<p+a&&(a+=q-(p+a));l<e+b&&(b+=l-(e+b));c+=b;e+=b;f+=a;p+=a},getCorner:function(b){var c=a();switch(b){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:a}}(),k=function(){function a(a){a=d("<div />").css({position:"absolute",opacity:b.borderOpacity}).addClass(b.baseClass+"-"+a);U.append(a);return a}function o(a,b){var c=d("<div />").mousedown(W(a)).css({cursor:a+"-resize",position:"absolute",zIndex:b});F.append(c);return c}
function n(a){var c=b.handleSize,d=g,f=c;switch(a){case "n":case "s":c=""+parseInt(100)+"%";break;case "e":case "w":f=""+parseInt(100)+"%"}return o(a,x++).width(c).height(f).css({top:e(-d+1),left:e(-d+1)})}function y(a){for(i in a)r[a[i]]=o(a[i],x++).css({top:e(-g+1),left:e(-g+1),opacity:b.handleOpacity}).addClass(b.baseClass+"-handle")}function c(a){var c=Math.round(a.h/2-g),b=Math.round(a.w/2-g);west=-g+1;var d=a.w-g,a=a.h-g;"e"in r&&r.e.css({top:e(c),left:e(d)})&&r.w.css({top:e(c)})&&r.s.css({top:e(a),
left:e(b)})&&r.n.css({left:e(b)});"ne"in r&&r.ne.css({left:e(d)})&&r.se.css({top:e(a),left:e(d)})&&r.sw.css({top:e(a)});"b"in r&&r.b.css({top:e(a)})&&r.r.css({left:e(d)})}function f(){var a=j.getFixed();j.setPressed([a.x,a.y]);j.setCurrent([a.x2,a.y2]);k()}function k(){if(v)return p()}function p(){var a=j.getFixed(),d=a.h;N.width(a.w).height(d);var d=a.x,f=a.y;aa.css({top:e(-f),left:e(-d)});N.css({top:e(f),left:e(d)});b.drawBorders&&s.right.css({left:e(a.w-1)})&&s.bottom.css({top:e(a.h-1)});m&&c(a);
v||(N.show(),t.css("opacity",b.bgOpacity),v=!0);b.onChange(R(a))}function q(){m=!0;if(b.allowResize)return c(j.getFixed()),F.show(),!0}function l(){m=!1;F.hide()}function u(a){(ca=a)?l():q()}var v,x=370,s={},r={},m=!1,g=b.handleOffset;b.drawBorders&&(s={top:a("hline").css("top",d.browser.msie?e(-1):e(0)),bottom:a("hline"),left:a("vline"),right:a("vline")});if(b.dragEdges)r.t=n("n"),r.b=n("s"),r.r=n("e"),r.l=n("w");b.sideHandles&&y(["n","s","e","w"]);b.cornerHandles&&y(["sw","nw","ne","se"]);var z=
X().mousedown(W("move")).css({cursor:"move",position:"absolute",zIndex:360});U.append(z);l();return{updateVisible:k,update:p,release:function(){l();N.hide();t.css("opacity",1);v=!1},refresh:f,setCursor:function(a){z.css("cursor",a)},enableHandles:q,enableOnly:function(){m=!0},showHandles:function(){m&&(c(j.getFixed()),F.show())},disableHandles:l,animMode:u,done:function(){u(!1);f()}}}(),z=function(){function a(a){n(A(a))}function e(f){f.preventDefault();f.stopPropagation();G&&(G=!1,y(A(f)),b.onSelect(R(j.getFixed())),
L.css({zIndex:290}),c&&d(document).unbind("mousemove",a).unbind("mouseup",e),n=function(){},y=function(){});return!1}var n=function(){},y=function(){},c=b.trackDocument;c||L.mousemove(a).mouseup(e).mouseout(e);t.before(L);return{activateHandlers:function(b,j){G=!0;n=b;y=j;L.css({zIndex:450});c&&d(document).mousemove(a).mouseup(e);return!1},setCursor:function(a){L.css("cursor",a)}}}(),P=function(){function a(a,c,d){b.allowMove&&(j.moveOffset([c,d]),k.updateVisible());a.preventDefault();a.stopPropagation()}
var e=d('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(function(b){if(b.ctrlKey)return!0;var c=(ha=b.shiftKey?!0:!1)?10:1;switch(b.keyCode){case 37:a(b,-c,0);break;case 39:a(b,c,0);break;case 38:a(b,0,-c);break;case 40:a(b,0,c);break;case 27:k.release();break;case 9:return!0}return nothing(b)}).blur(function(){e.hide()}),n=d("<div />").css({position:"absolute",overflow:"hidden"}).append(e);b.keySupport&&n.insertBefore(t);return{watchKeys:function(){b.keySupport&&(e.show(),
e.focus())}}}();F.hide();S(!0);D={animateTo:function(a){var d=a[2]/u,e=a[3]/v;if(!ca){var a=j.flipCoords(a[0]/u,a[1]/v,d,e),l=j.getFixed(),c=initcr=[l.x,l.y,l.x2,l.y2],f=b.animationDelay,q=c[0],p=c[1],d=c[2],e=c[3],t=a[0]-initcr[0],x=a[1]-initcr[1],s=a[2]-initcr[2],z=a[3]-initcr[3],B=0,A=b.swingSpeed;k.animMode(!0);var r=function(){return function(){B+=(100-B)/A;c[0]=q+B/100*t;c[1]=p+B/100*x;c[2]=d+B/100*s;c[3]=e+B/100*z;B<100?window.setTimeout(r,f):k.done();B>=99.8&&(B=100);Z(c)}}();window.setTimeout(r,
f)}},setSelect:Y,setOptions:function(a){$(a);S()},tellSelect:function(){return R(j.getFixed())},tellScaled:function(){return j.getFixed()},disable:function(){b.disabled=!0;k.disableHandles();k.setCursor("default");z.setCursor("default")},enable:function(){b.disabled=!1;S()},cancel:function(){k.done();z.activateHandlers(null,null)},focus:P.watchKeys,getBounds:function(){return[l*u,q*v]},getWidgetSize:function(){return[l,q]},release:k.release,destroy:function(){T.remove();C.show()}};C.data("Jcrop",
D);return D};d.fn.Jcrop=function(x){function s(e){var s=x.useImg||e.src,A=new Image;A.onload=function(){d.Jcrop(e,x)};A.src=s}typeof x!=="object"&&(x={});this.each(function(){if(d(this).data("Jcrop"))if(x=="api")return d(this).data("Jcrop");else d(this).data("Jcrop").setOptions(x);else s(this)});return this}})(jQuery);