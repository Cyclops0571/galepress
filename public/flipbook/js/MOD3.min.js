/**
*
* http://github.com/foo123/MOD3
*
* MOD3 3D Modifier Library (port of actionscript AS3Mod to javascript)
* supports: THREE.js, J3D, Copperlicht, Pre3D
*
* @author Nikos M.
* @url http://nikos-web-development.netai.net/
*
**/
var MOD3=MOD3||{};(function(a){a.Constants={PI:Math.PI,invPI:1/Math.PI,halfPI:0.5*Math.PI,doublePI:2*Math.PI,toRad:1/180*Math.PI,toDeg:1/180*Math.PI};a.ModConstant={LEFT:-1,RIGHT:1,NONE:0,X:1,Y:2,Z:4}})(MOD3);
(function(a){var c=a.Constants;a.XMath={};a.XMath.normalize=function(c,d,e){return d-c==0?1:a.XMath.trim(0,1,(e-c)/d)};a.XMath.toRange=function(a,c,e){return c-a==0?0:a+(c-a)*e};a.XMath.inRange=function(a,c,e,f){typeof f=="undefined"&&(f=!1);return f?e>=a&&e<=c:e>a&&e<c};a.XMath.sign=function(a,c){typeof c=="undefined"&&(c=0);return 0==a?c:a>0?1:-1};a.XMath.trim=function(a,c,e){return Math.min(c,Math.max(a,e))};a.XMath.wrap=function(a,c,e){return e<a?e+(c-a):e>=c?e-(c-a):e};a.XMath.degToRad=function(a){return a*
c.toRad};a.XMath.radToDeg=function(a){return a*c.toDeg};a.XMath.presicion=function(a,c){var e=Math.pow(10,c);return Math.round(a*e)/e};a.XMath.uceil=function(a){return a<0?Math.floor(a):Math.ceil(a)}})(MOD3);
(function(a){a.Range=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};a.Range.prototype.getSize=function(){return this.end-this.start};a.Range.prototype.move=function(a){this.start+=a;this.end+=a};a.Range.prototype.isIn=function(a){return a>=this.start&&a<=this.end};a.Range.prototype.normalize=function(c){return a.XMath.normalize(this.start,this.end,c)};a.Range.prototype.toRange=function(c){return a.XMath.toRange(this.start,this.end,
c)};a.Range.prototype.trim=function(c){return a.XMath.trim(this.start,this.end,c)};a.Range.prototype.interpolate=function(a,b){return this.toRange(b.normalize(a))};a.Range.prototype.toString=function(){return"["+this.start+" - "+this.end+"]"}})(MOD3);
(function(a){a.Phase=function(a){this.value=0;if(typeof a!="undefined")this.value=a};a.Phase.prototype.getPhasedValue=function(){return Math.sin(this.value)};a.Phase.prototype.getAbsPhasedValue=function(){return Math.abs(this.getPhasedValue())};a.Phase.prototype.getNormValue=function(){return(this.getPhasedValue()+1)*0.5}})(MOD3);
(function(a){a.Point=function(a,b){this.y=this.x=0;if(typeof a!="undefined")this.x=a;if(typeof b!="undefined")this.y=b};a.Point.prototype.clone=function(){return new a.Point(this.x,this.y)}})(MOD3);
(function(a){a.Matrix=function(a,b,d,e){this.m11=1;this.m21=this.m12=0;this.m22=1;if(typeof a!="undefined")this.m11=a;if(typeof b!="undefined")this.m12=b;if(typeof d!="undefined")this.m21=d;if(typeof e!="undefined")this.m22=e};a.Matrix.prototype.rotate=function(a){var b=Math.cos(a),a=Math.sin(a);this.m11=b;this.m12=-a;this.m21=a;this.m22=b;return this};a.Matrix.prototype.scale=function(a,b){this.m21=this.m12=0;if(typeof a!="undefined")this.m22=this.m11=a;if(typeof b!="undefined")this.m22=b;return this};
a.Matrix.prototype.multiply=function(a){var b=this.m11,d=this.m12,e=this.m21,f=this.m22,g=a.m11,h=a.m12,i=a.m21,a=a.m22;this.m11=b*g+d*i;this.m12=b*h+d*a;this.m21=e*g+f*i;this.m22=e*h+f*a;return this};a.Matrix.prototype.transformPoint=function(c){return new a.Point(this.m11*c.x+this.m12*c.y,this.m21*c.x+this.m22*c.y)}})(MOD3);
(function(a){a.Vector3=function(a,b,d){this.z=this.y=this.x=null;this.x=a;this.y=b;this.z=d};a.Vector3.ZERO=function(){return new a.Vector3(0,0,0)};a.Vector3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};a.Vector3.prototype.clone=function(){return new a.Vector3(this.x,this.y,this.z)};a.Vector3.prototype.equals=function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z};a.Vector3.prototype.zero=function(){this.x=this.y=this.z=0};a.Vector3.prototype.negate=function(){return new a.Vector3(-this.x,
-this.y,-this.z)};a.Vector3.prototype.add=function(c){return new a.Vector3(this.x+c.x,this.y+c.y,this.z+c.z)};a.Vector3.prototype.subtract=function(c){return new a.Vector3(this.x-c.x,this.y-c.y,this.z-c.z)};a.Vector3.prototype.multiplyScalar=function(c){return new a.Vector3(this.x*c,this.y*c,this.z*c)};a.Vector3.prototype.multiply=function(c){return new a.Vector3(this.x*c.x,this.y*c.y,this.z*c.z)};a.Vector3.prototype.divide=function(c){c=1/c;return new a.Vector3(this.x*c,this.y*c,this.z*c)};a.Vector3.prototype.normalize=
function(){var a=this.x,b=this.y,d=this.z,a=a*a+b*b+d*d;a>0&&(a=1/Math.sqrt(a),this.x*=a,this.y*=a,this.z*=a)};a.Vector3.prototype.getMagnitude=function(){var a=this.x,b=this.y,d=this.z;return Math.sqrt(a*a+b*b+d*d)};a.Vector3.prototype.setMagnitude=function(a){this.normalize();this.x*=a;this.y*=a;this.z*=a};a.Vector3.prototype.toString=function(){return"["+this.x+" , "+this.y+" , "+this.z+"]"};a.Vector3.prototype.sum=function(a,b){return a.add(b)};a.Vector3.prototype.dot=function(a,b){return a.x*
b.x+a.y*b.y+a.z*b.z};a.Vector3.prototype.cross=function(c,b){var d=c.x,e=c.y,f=c.z,g=b.x,h=b.y,i=b.z;return new a.Vector3(e*i-f*h,f*g-d*i,d*h-e*g)};a.Vector3.prototype.distance=function(a,b){var d=a.x-b.x,e=a.y-b.y,f=a.z-b.z;return Math.sqrt(d*d+e*e+f*f)}})(MOD3);
(function(a){a.Matrix4=function(a,b,d,e,f,g,h,i,n,m,o,k,p,l,j,q){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1;if(typeof a!="undefined")this.n11=a;if(typeof b!="undefined")this.n12=b;if(typeof d!="undefined")this.n13=d;if(typeof e!="undefined")this.n14=e;if(typeof f!="undefined")this.n21=f;if(typeof g!="undefined")this.n22=g;if(typeof h!="undefined")this.n23=h;if(typeof i!="undefined")this.n24=
i;if(typeof n!="undefined")this.n31=n;if(typeof m!="undefined")this.n32=m;if(typeof o!="undefined")this.n33=o;if(typeof k!="undefined")this.n34=k;if(typeof p!="undefined")this.n41=p;if(typeof l!="undefined")this.n42=l;if(typeof j!="undefined")this.n43=j;if(typeof q!="undefined")this.n44=q};a.Matrix4.prototype.translationMatrix=function(a,b,d){this.n14=a;this.n24=b;this.n34=d;return this};a.Matrix4.prototype.scaleMatrix=function(a,b,d){this.n11=a;this.n22=b;this.n33=d;return this};a.Matrix4.prototype.rotationMatrix=
function(a,b,d,e){var f=Math.cos(e),g=Math.sin(e),e=1-f,h=a*b*e,i=b*d*e,n=a*d*e,m=g*d,o=g*b;g*=a;this.n11=f+a*a*e;this.n12=-m+h;this.n13=o+n;this.n14=0;this.n21=m+h;this.n22=f+b*b*e;this.n23=-g+i;this.n24=0;this.n31=-o+n;this.n32=g+i;this.n33=f+d*d*e;this.n34=0;return this};a.Matrix4.prototype.calculateMultiply=function(a,b){var d=a.n11,e=b.n11,f=a.n21,g=b.n21,h=a.n31,i=b.n31,n=a.n12,m=b.n12,o=a.n22,k=b.n22,p=a.n32,l=b.n32,j=a.n13,q=b.n13,r=a.n23,t=b.n23,s=a.n33,u=b.n33,v=a.n14,w=b.n14,z=a.n24,x=
b.n24,A=a.n34,y=b.n34;this.n11=d*e+n*g+j*i;this.n12=d*m+n*k+j*l;this.n13=d*q+n*t+j*u;this.n14=d*w+n*x+j*y+v;this.n21=f*e+o*g+r*i;this.n22=f*m+o*k+r*l;this.n23=f*q+o*t+r*u;this.n24=f*w+o*x+r*y+z;this.n31=h*e+p*g+s*i;this.n32=h*m+p*k+s*l;this.n33=h*q+p*t+s*u;this.n34=h*w+p*x+s*y+A};a.Matrix4.prototype.multiply=function(a,b){this.calculateMultiply(a,b);return this};a.Matrix4.prototype.multiplyVector=function(a,b){var d=b.x,e=b.y,f=b.z;b.x=d*a.n11+e*a.n12+f*a.n13+a.n14;b.y=d*a.n21+e*a.n22+f*a.n23+a.n24;
b.z=d*a.n31+e*a.n32+f*a.n33+a.n34}})(MOD3);
(function(a){a.VertexProxy=function(a){this.originalZ=this.originalY=this.originalX=this.ratioZ=this.ratioY=this.ratioX=null;if(typeof a!="undefined")this.vertex=a};a.VertexProxy.prototype.setVertex=function(){};a.VertexProxy.prototype.setRatios=function(a,b,d){this.ratioX=a;this.ratioY=b;this.ratioZ=d};a.VertexProxy.prototype.setOriginalPosition=function(a,b,d){this.originalX=a;this.originalY=b;this.originalZ=d};a.VertexProxy.prototype.getX=function(){};a.VertexProxy.prototype.getY=function(){};
a.VertexProxy.prototype.getZ=function(){};a.VertexProxy.prototype.setX=function(){};a.VertexProxy.prototype.setY=function(){};a.VertexProxy.prototype.setZ=function(){};a.VertexProxy.prototype.getValue=function(c){switch(c){case a.ModConstant.X:return this.getX();case a.ModConstant.Y:return this.getY();case a.ModConstant.Z:return this.getZ()}return 0};a.VertexProxy.prototype.setValue=function(c,b){switch(c){case a.ModConstant.X:this.setX(b);break;case a.ModConstant.Y:this.setY(b);break;case a.ModConstant.Z:this.setZ(b)}};
a.VertexProxy.prototype.getRatio=function(c){switch(c){case a.ModConstant.X:return this.ratioX;case a.ModConstant.Y:return this.ratioY;case a.ModConstant.Z:return this.ratioZ}return-1};a.VertexProxy.prototype.getOriginalValue=function(c){switch(c){case a.ModConstant.X:return this.originalX;case a.ModConstant.Y:return this.originalY;case a.ModConstant.Z:return this.originalZ}return 0};a.VertexProxy.prototype.reset=function(){this.setX(this.originalX);this.setY(this.originalY);this.setZ(this.originalZ)};
a.VertexProxy.prototype.collapse=function(){this.originalX=this.getX();this.originalY=this.getY();this.originalZ=this.getZ()};a.VertexProxy.prototype.getVector=function(){return new a.Vector3(this.getX(),this.getY(),this.getZ())};a.VertexProxy.prototype.setVector=function(a){this.setX(a.x);this.setY(a.y);this.setZ(a.z)};a.VertexProxy.prototype.getRatioVector=function(){return new a.Vector3(this.ratioX,this.ratioY,this.ratioZ)}})(MOD3);
(function(a){a.FaceProxy=function(){this.vertices=[]};a.FaceProxy.prototype.addVertex=function(a){this.vertices.push(a)};a.FaceProxy.prototype.getVertices=function(){return this.vertices}})(MOD3);
(function(a){a.MeshProxy=function(){this.depth=this.height=this.width=this.minAxis=this.midAxis=this.maxAxis=this.minZ=this.minY=this.minX=this.maxZ=this.maxY=this.maxX=null;this.vertices=[];this.faces=[];this.mesh=null};a.MeshProxy.prototype.getVertices=function(){return this.vertices};a.MeshProxy.prototype.getFaces=function(){return this.faces};a.MeshProxy.prototype.analyzeGeometry=function(){for(var c=this.getVertices(),b=c.length,d=b,e,f,g,h,i,n,m,o,k,p,l=!0,j=Math.min,q=Math.max;--d>=0;)e=c[d],
f=e.getX(),g=e.getY(),h=e.getZ(),l?(i=n=f,m=o=g,k=p=h,l=!1):(i=j(i,f),m=j(m,g),k=j(k,h),n=q(n,f),o=q(o,g),p=q(p,h)),e.setOriginalPosition(f,g,h);f=n-i;g=o-m;depth=p-k;this.width=f;this.height=g;this.depth=depth;this.minX=i;this.maxX=n;this.minY=m;this.maxY=o;this.minZ=k;this.maxZ=p;d=q(f,q(g,depth));j=j(f,j(g,depth));if(d==f&&j==g)this.minAxis=a.ModConstant.Y,this.midAxis=a.ModConstant.Z,this.maxAxis=a.ModConstant.X;else if(d==f&&j==depth)this.minAxis=a.ModConstant.Z,this.midAxis=a.ModConstant.Y,
this.maxAxis=a.ModConstant.X;else if(d==g&&j==f)this.minAxis=a.ModConstant.X,this.midAxis=a.ModConstant.Z,this.maxAxis=a.ModConstant.Y;else if(d==g&&j==depth)this.minAxis=a.ModConstant.Z,this.midAxis=a.ModConstant.X,this.maxAxis=a.ModConstant.Y;else if(d==depth&&j==f)this.minAxis=a.ModConstant.X,this.midAxis=a.ModConstant.Y,this.maxAxis=a.ModConstant.Z;else if(d==depth&&j==g)this.minAxis=a.ModConstant.Y,this.midAxis=a.ModConstant.X,this.maxAxis=a.ModConstant.Z;for(d=b;--d>=0;)e=c[d],e.setRatios((e.getX()-
i)/f,(e.getY()-m)/g,(e.getZ()-k)/depth)};a.MeshProxy.prototype.resetGeometry=function(){for(var a=this.getVertices(),b=a.length;--b>=0;)a[b].reset()};a.MeshProxy.prototype.collapseGeometry=function(){for(var a=this.getVertices(),b=a.length;--b>=0;)a[b].collapse();this.analyzeGeometry()};a.MeshProxy.prototype.getMin=function(c){switch(c){case a.ModConstant.X:return this.minX;case a.ModConstant.Y:return this.minY;case a.ModConstant.Z:return this.minZ}return-1};a.MeshProxy.prototype.getMax=function(c){switch(c){case a.ModConstant.X:return this.maxX;
case a.ModConstant.Y:return this.maxY;case a.ModConstant.Z:return this.maxZ}return-1};a.MeshProxy.prototype.getSize=function(c){switch(c){case a.ModConstant.X:return this.width;case a.ModConstant.Y:return this.height;case a.ModConstant.Z:return this.depth}return-1};a.MeshProxy.prototype.setMesh=function(a){this.mesh=a;this.vertices=[];this.faces=[]};a.MeshProxy.prototype.postApply=function(){};a.MeshProxy.prototype.updateMeshPosition=function(){}})(MOD3);
(function(a){a.Modifier=function(){this.mod=null};a.Modifier.prototype.setModifiable=function(a){this.mod=a};a.Modifier.prototype.getVertices=function(){return this.mod.getVertices()};a.Modifier.prototype.apply=function(){}})(MOD3);(function(a){a.Library3d=function(){this.id="";this.vertexClass=this.meshClass=null}})(MOD3);(function(a){a.PluginFactory={};a.PluginFactory.getMeshProxy=function(a){return new a.meshClass}})(MOD3);
(function(a){a.ModifierStack=function(c,b){this.lib3d=c;this.stack=this.baseMesh=null;this.baseMesh=a.PluginFactory.getMeshProxy(c);this.baseMesh.setMesh(b);this.baseMesh.analyzeGeometry();this.stack=[]};a.ModifierStack.prototype.addModifier=function(a){a.setModifiable(this.baseMesh);this.stack.push(a)};a.ModifierStack.prototype.apply=function(){this.baseMesh.resetGeometry();for(var a=this.stack,b=a.length,d=0;d<b;)a[d++].apply();this.baseMesh.postApply()};a.ModifierStack.prototype.collapse=function(){this.apply();
this.baseMesh.collapseGeometry();this.stack=[]};a.ModifierStack.prototype.clear=function(){this.stack=[]};a.ModifierStack.prototype.getMeshInfo=function(){return this.baseMesh}})(MOD3);
(function(a){a.Pivot=function(c,b,d){this.pivot=new a.Vector3(c,b,d)};a.Pivot.prototype=new a.Modifier;a.Pivot.prototype.constructor=a.Pivot;a.Pivot.prototype.setMeshCenter=function(){var c=this.mod;this.pivot=new a.Vector3(-(c.minX+0.5*c.width),-(c.minY+0.5*c.height),-(c.minZ+0.5*c.depth))};a.Pivot.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,d=this.pivot,e,f;--b>=0;)e=a[b],f=e.getVector().clone(),e.setVector(f.add(d));this.mod.updateMeshPosition(d.clone().negate())}})(MOD3);
(function(a){a.Bend=function(c,b,d){this.diagAngle=this.angle=this.offset=this.force=null;this.constraint=a.ModConstant.NONE;this.m2=this.m1=this.origin=this.height=this.width=this.mid=this.min=this.max=null;this.switchAxes=!1;this.force=c;this.offset=b;this.setAngle(d)};a.Bend.prototype=new a.Modifier;a.Bend.prototype.constructor=a.Bend;a.Bend.prototype.setAngle=function(c){this.angle=c;this.m1=new a.Matrix;this.m1.rotate(c);this.m2=new a.Matrix;this.m2.rotate(-c)};a.Bend.prototype.setModifiable=
function(c){a.Modifier.prototype.setModifiable.call(this,c);this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis;this.min=this.mod.minAxis;this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis;this.width=this.mod.getSize(this.max);this.height=this.mod.getSize(this.mid);this.origin=this.mod.getMin(this.max);this.diagAngle=Math.atan(this.width/this.height)};a.Bend.prototype.apply=function(){if(this.force!=0)for(var c=this.mod.getVertices(),b=c.length,d=this.width,e=this.offset,f=this.origin,
g=this.max,h=this.min,i=this.mid,n=this.m1,m=this.m2,o=f+d*e,k=d/Math.PI/this.force,p=a.Constants.doublePI*(d/(k*a.Constants.doublePI)),l,j,q,r,t=1/d,s=a.Constants.halfPI,u=Math.sin,v=Math.cos;--b>=0;)d=c[b],l=d.getValue(g),j=d.getValue(i),q=d.getValue(h),j=n.transformPoint(new a.Point(l,j)),l=j.x,j=j.y,r=(l-f)*t,this.constraint==a.ModConstant.LEFT&&r<=e||this.constraint==a.ModConstant.RIGHT&&r>=e||(r=s-p*e+p*r,l=u(r)*(k+q),r=v(r)*(k+q),q=l-k,l=o-r),j=m.transformPoint(new a.Point(l,j)),l=j.x,j=j.y,
d.setValue(g,l),d.setValue(i,j),d.setValue(h,q)}})(MOD3);
(function(a){a.Bloat=function(){this.center=a.Vector3.ZERO();this.radius=0;this.a=0.01;this.u=a.Vector3.ZERO()};a.Bloat.prototype=new a.Modifier;a.Bloat.prototype.constructor=a.Bloat;a.Bloat.prototype.setRadius=function(a){this.radius=Math.max(0,a)};a.Bloat.prototype.setA=function(a){this.a=Math.max(0,a)};a.Bloat.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,d=this.center,e=this.radius,f=this.a,g,h;--b>=0;)g=a[b],this.u.x=g.getX()-d.x,this.u.y=g.getY()-d.y,this.u.z=g.getZ()-
d.z,h=this.u.getMagnitude(),this.u.setMagnitude(h+e*Math.exp(-h*f)),g.setX(this.u.x+d.x),g.setY(this.u.y+d.y),g.setZ(this.u.z+d.z)}})(MOD3);
(function(a){a.Twist=function(c){this.vector=new a.Vector3(0,1,0);this.angle=c;this.center=a.Vector3.ZERO()};a.Twist.prototype=new a.Modifier;a.Twist.prototype.constructor=a.Twist;a.Twist.prototype.apply=function(){this.vector.normalize();for(var c=this.mod,b=c.getVertices(),d=b.length,e=this.vector,f=this.angle,g=this.center,c=1/(new a.Vector3(0.5*c.maxX,0.5*c.maxY,0.5*c.maxZ)).getMagnitude()*f,g=-a.Vector3.dot(e,g),h;--d>=0;)f=b[d],h=f.getX()*e.x+f.getY()*e.y+f.getZ()*e.z+g,this.twistPoint(f,h*
c)};a.Twist.prototype.twistPoint=function(c,b){var d=(new a.Matrix4).translationMatrix(c.getX(),c.getY(),c.getZ()),d=(new a.Matrix4).multiply((new a.Matrix4).rotationMatrix(this.vector.x,this.vector.y,this.vector.z,b),d);c.setX(d.n14);c.setY(d.n24);c.setZ(d.n34)}})(MOD3);
(function(a){a.Skew=function(c){this.force=0;this.skewAxis=null;if(typeof c!="undefined")this.force=c;this.offset=0.5;this.constraint=a.ModConstant.NONE;this.falloff=this.power=1;this.swapAxes=this.oneSide=this.inverseFalloff=!1};a.Skew.prototype=new a.Modifier;a.Skew.prototype.constructor=a.Skew;a.Skew.prototype.setModifiable=function(c){a.Modifier.prototype.setModifiable.call(this,c);this.skewAxis=this.skewAxis||this.mod.maxAxis};a.Skew.prototype.apply=function(){for(var c=this.mod.getVertices(),
b=c.length,d=this.constraint,e=this.skewAxis,f=this.offset,g=this.oneSide,h=this.inverseFalloff,i=this.falloff,n=1-i,m=this.power,o=this.force,k=this.getDisplaceAxis(),p,l,j;--b>=0;)p=c[b],!(d==a.ModConstant.LEFT&&p.getRatio(e)<=f)&&!(d==a.ModConstant.RIGHT&&p.getRatio(e)>f)&&(l=p.getRatio(e)-f,g&&(l=Math.abs(l)),j=p.getRatio(k),h&&(j=1-j),j=i+j*n,l=Math.pow(Math.abs(l),m)*a.XMath.sign(l,1),l=p.getValue(k)+o*l*j,p.setValue(k,l))};a.Skew.prototype.getDisplaceAxis=function(){switch(this.skewAxis){case a.ModConstant.X:return this.swapAxes?
a.ModConstant.Z:a.ModConstant.Y;case a.ModConstant.Y:return this.swapAxes?a.ModConstant.Z:a.ModConstant.X;case a.ModConstant.Z:return this.swapAxes?a.ModConstant.Y:a.ModConstant.X;default:return 0}}})(MOD3);
(function(a){a.Taper=function(c){this.power=this.force=null;this.start=0;this.end=1;this.vector=new a.Vector3(1,0,1);this.vector2=new a.Vector3(0,1,0);if(typeof c!="undefined")this.force=c;this.power=1};a.Taper.prototype=new a.Modifier;a.Taper.prototype.constructor=a.Taper;a.Taper.prototype.setFalloff=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};a.Taper.prototype.apply=function(){for(var c=this.mod.getVertices(),b=c.length,d=this.vector,
e=this.vector2,f=this.force,g=this.power,h,i,n;--b>=0;)h=c[b],i=h.getRatioVector().multiply(e),i=f*Math.pow(i.getMagnitude(),g),i=(new a.Matrix4).scaleMatrix(1+i*d.x,1+i*d.y,1+i*d.z),n=h.getVector(),(new a.Matrix4).multiplyVector(i,n),h.setVector(n)}})(MOD3);
(function(a){a.Wheel=function(){this.radius=this.roll=this.turn=this.speed=null;this.steerVector=new a.Vector3(0,1,0);this.rollVector=new a.Vector3(0,0,1);this.roll=this.turn=this.speed=0};a.Wheel.prototype=new a.Modifier;a.Wheel.prototype.constructor=a.Wheel;a.Wheel.prototype.setModifiable=function(c){a.Modifier.prototype.setModifiable.call(this,c);this.radius=0.5*this.mod.width};a.Wheel.prototype.apply=function(){this.roll+=this.speed;var c=this.mod.getVertices(),b=c.length,d=this.steerVector,e=
this.turn,f=this.rollVector,g=this.roll,h;0!=e?(h=(new a.Matrix4).rotationMatrix(d.x,d.y,d.z,e),d=f.clone(),(new a.Matrix4).multiplyVector(h,d),g=(new a.Matrix4).rotationMatrix(d.x,d.y,d.z,g)):g=(new a.Matrix4).rotationMatrix(f.x,f.y,f.z,g);for(;--b>=0;)d=c[b],f=d.getVector().clone(),0!=e&&(new a.Matrix4).multiplyVector(h,f),(new a.Matrix4).multiplyVector(g,f),d.setX(f.x),d.setY(f.y),d.setZ(f.z)};a.Wheel.prototype.getStep=function(){return this.radius*this.speed*a.Constants.invPI};a.Wheel.prototype.getPerimeter=
function(){return this.radius*a.Constants.doublePI}})(MOD3);
(function(a){a.Break=function(c,b){this.bv=new a.Vector3(0,1,0);this.angle=this.offset=0;if(typeof c!="undefined")this.offset=c;if(typeof b!="undefined")this.angle=b;this.range=new a.Range(0,1)};a.Break.prototype=new a.Modifier;a.Break.prototype.constructor=a.Break;a.Break.prototype.apply=function(){var c=this.mod,b=c.getVertices(),d=b.length,e=this.range,f=this.angle,g=this.bv,h,i,c=new a.Vector3(0,0,-(c.minZ+c.depth*this.offset));h=c.negate();for(i=(new a.Matrix4).rotationMatrix(g.x,g.y,g.z,f);--d>=
0;)f=b[d],g=f.getVector(),g=g.add(c),g.z>=0&&e.isIn(f.ratioY)&&(new a.Matrix4).multiplyVector(i,g),g=g.add(h),f.setX(g.x),f.setY(g.y),f.setZ(g.z)}})(MOD3);
(function(a){a.Noise=function(c){this.force=0;this.axc=a.ModConstant.NONE;this.end=this.start=0;if(typeof c!="undefined")this.force=c};a.Noise.prototype=new a.Modifier;a.Noise.prototype.constructor=a.Noise;a.Noise.prototype.constraintAxes=function(a){this.axc=a};a.Noise.prototype.setFalloff=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};a.Noise.prototype.apply=function(){for(var a=this.mod,b=this.axc,d=this.start,e=this.end,f=a.getVertices(),
g=f.length,h=this.force,i=0.5*h,n=Math.random,m,o,k;--g>=0;)m=f[g],o=n()*h-i,k=m.getRatio(a.maxAxis),d<e?(k<d&&(k=0),k>e&&(k=1)):d>e?(k=1-k,k>d&&(k=0),k<e&&(k=1)):k=1,b&1||m.setX(m.getX()+o*k),b>>1&1||m.setY(m.getY()+o*k),b>>2&1||m.setZ(m.getZ()+o*k)}})(MOD3);(function(a){a.LibraryThree=function(){this.id="Three.js";this.meshClass=a.MeshThree;this.vertexClass=a.VertexThree};a.LibraryThree.prototype=new a.Library3d;a.LibraryThree.prototype.constructor=a.LibraryThree})(MOD3);
(function(a){a.VertexThree=function(a){this.mesh=a};a.VertexThree.prototype=new a.VertexProxy;a.VertexThree.prototype.setVertex=function(a){this.vertex=a;this.originalX=a.x;this.originalY=a.y;this.originalZ=a.z};a.VertexThree.prototype.getX=function(){return this.vertex.x};a.VertexThree.prototype.getY=function(){return this.vertex.y};a.VertexThree.prototype.getZ=function(){return this.vertex.z};a.VertexThree.prototype.setX=function(a){this.vertex.x=a;a=this.mesh;a.geometry.verticesNeedUpdate=!0;a.geometry.normalsNeedUpdate=
!0;a.geometry.buffersNeedUpdate=!0;a.geometry.dynamic=!0};a.VertexThree.prototype.setY=function(a){this.vertex.y=a;a=this.mesh;a.geometry.verticesNeedUpdate=!0;a.geometry.normalsNeedUpdate=!0;a.geometry.buffersNeedUpdate=!0;a.geometry.dynamic=!0};a.VertexThree.prototype.setZ=function(a){this.vertex.z=a;a=this.mesh;a.geometry.verticesNeedUpdate=!0;a.geometry.normalsNeedUpdate=!0;a.geometry.buffersNeedUpdate=!0;a.geometry.dynamic=!0}})(MOD3);
(function(a){a.MeshThree=function(){};a.MeshThree.prototype=new a.MeshProxy;a.MeshThree.prototype.setMesh=function(c){a.MeshProxy.prototype.setMesh.call(this,c);for(var c=[],b=0,d=this.mesh.geometry.vertices,e=d.length,f=this.mesh.geometry.faces,g=f.length,h,b=0;b<e;)h=new a.VertexThree(this.mesh),h.setVertex(d[b]),this.vertices.push(h),c[d[b]]=h,b++;for(b=0;b<g;)e=new a.FaceProxy,f[b]instanceof THREE.Face3?(e.addVertex(c[d[f[b].a]]),e.addVertex(c[d[f[b].b]]),e.addVertex(c[d[f[b].c]])):f[b]instanceof
THREE.Face4&&(e.addVertex(c[d[f[b].a]]),e.addVertex(c[d[f[b].b]]),e.addVertex(c[d[f[b].c]]),e.addVertex(c[d[f[b].d]])),this.faces.push(e),b++;delete lookup};a.MeshThree.prototype.updateMeshPosition=function(a){var b=this.mesh;b.position.x+=a.x;b.position.y+=a.y;b.position.z+=a.z}})(MOD3);(function(a){a.LibraryPre3D=function(){this.id="pre3d.js";this.meshClass=a.MeshPre3D;this.vertexClass=a.VertexPre3D};a.LibraryThree.prototype=new a.Library3d;a.LibraryThree.prototype.constructor=a.LibraryPre3D})(MOD3);
(function(a){a.VertexPre3D=function(){};a.VertexPre3D.prototype=new a.VertexProxy;a.VertexPre3D.prototype.setVertex=function(a){this.vertex=a;this.originalX=a.x;this.originalY=a.y;this.originalZ=a.z};a.VertexPre3D.prototype.getX=function(){return this.vertex.x};a.VertexPre3D.prototype.getY=function(){return this.vertex.y};a.VertexPre3D.prototype.getZ=function(){return this.vertex.z};a.VertexPre3D.prototype.setX=function(a){this.vertex.x=a};a.VertexPre3D.prototype.setY=function(a){this.vertex.y=a};
a.VertexPre3D.prototype.setZ=function(a){this.vertex.z=a}})(MOD3);
(function(a){a.MeshPre3D=function(){};a.MeshPre3D.prototype=new a.MeshProxy;a.MeshPre3D.prototype.setMesh=function(c){a.MeshProxy.prototype.setMesh.call(this,c);for(var c=[],b=this.mesh.vertices,d=this.mesh.quads,e=b.length,f=d.length,g=0;g<e;g++){var h=new a.VertexPre3D;h.setVertex(b[g]);this.vertices.push(h);c[b[g]]=h}for(g=0;g<f;g++)e=new a.FaceProxy,d[g]instanceof Pre3d.QuadFace&&(e.addVertex(c[b[d[g].i0]]),e.addVertex(c[b[d[g].i1]]),e.addVertex(c[b[d[g].i2]]),d[g].i3!=null&&e.addVertex(c[b[d[g].i3]])),
this.faces.push(e);delete lookup};a.MeshPre3D.prototype.updateMeshPosition=function(){}})(MOD3);(function(a){a.LibraryJ3D=function(){this.id="J3D";this.meshClass=a.MeshJ3D;this.vertexClass=a.VertexJ3D};a.LibraryJ3D.prototype=new a.Library3d;a.LibraryJ3D.prototype.constructor=a.LibraryJ3D})(MOD3);
(function(a){a.VertexJ3D=function(a){this.geometry=a};a.VertexJ3D.prototype=new a.VertexProxy;a.VertexJ3D.prototype.setVertex=function(a){this.vertex=a;var b=this.geometry;this.originalX=b.vertexPositionBuffer.data[a];this.originalY=b.vertexPositionBuffer.data[a+1];this.originalZ=b.vertexPositionBuffer.data[a+2]};a.VertexJ3D.prototype.getX=function(){return this.geometry.vertexPositionBuffer.data[this.vertex]};a.VertexJ3D.prototype.getY=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+
1]};a.VertexJ3D.prototype.getZ=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+2]};a.VertexJ3D.prototype.setX=function(a){var b=this.geometry;b.vertexPositionBuffer.data[this.vertex]=a;b.replaceArray(b.vertexPositionBuffer,b.vertexPositionBuffer.data)};a.VertexJ3D.prototype.setY=function(a){var b=this.geometry;b.vertexPositionBuffer.data[this.vertex+1]=a;b.replaceArray(b.vertexPositionBuffer,b.vertexPositionBuffer.data)};a.VertexJ3D.prototype.setZ=function(a){var b=this.geometry;
b.vertexPositionBuffer.data[this.vertex+2]=a;b.replaceArray(b.vertexPositionBuffer,b.vertexPositionBuffer.data)}})(MOD3);
(function(a){a.MeshJ3D=function(){};a.MeshJ3D.prototype=new a.MeshProxy;a.MeshJ3D.prototype.setMesh=function(c){a.MeshProxy.prototype.setMesh.call(this,c);for(var b=0,d=c.geometry.vertexPositionBuffer.data.length,e=c.geometry.vertexPositionBuffer.itemSize,f,b=0;b<d;)f=new a.VertexJ3D(c.geometry),f.setVertex(b),this.vertices.push(f),b+=e;this.faces=null};a.MeshJ3D.prototype.updateMeshPosition=function(a){var b=this.mesh;b.position.x+=a.x;b.position.y+=a.y;b.position.z+=a.z}})(MOD3);
(function(a){a.LibraryCopperlicht=function(){this.id="Copperlicht";this.meshClass=a.MeshCopperlicht;this.vertexClass=a.VertexCopperlicht};a.LibraryCopperlicht.prototype=new a.Library3d;a.LibraryCopperlicht.prototype.constructor=a.LibraryCopperlicht})(MOD3);
(function(a){a.VertexCopperlicht=function(a,b){this.node=a;this.buffer=b};a.VertexCopperlicht.prototype=new a.VertexProxy;a.VertexCopperlicht.prototype.setVertex=function(a){this.vertex=a;this.originalX=this.vertex.Pos.X;this.originalY=this.vertex.Pos.Y;this.originalZ=this.vertex.Pos.Z};a.VertexCopperlicht.prototype.getX=function(){return this.vertex.Pos.X};a.VertexCopperlicht.prototype.getY=function(){return this.vertex.Pos.Y};a.VertexCopperlicht.prototype.getZ=function(){return this.vertex.Pos.Z};
a.VertexCopperlicht.prototype.setX=function(a){this.vertex.Pos.X=a;this.buffer.update(!0)};a.VertexCopperlicht.prototype.setY=function(a){this.vertex.Pos.Y=a;this.buffer.update(!0)};a.VertexCopperlicht.prototype.setZ=function(a){this.vertex.Pos.Z=a;this.buffer.update(!0)}})(MOD3);
(function(a){a.MeshCopperlicht=function(){};a.MeshCopperlicht.prototype=new a.MeshProxy;a.MeshCopperlicht.prototype.setMesh=function(c){a.MeshProxy.prototype.setMesh.call(this,c);for(var c=this.mesh.getMesh().GetMeshBuffers(),b=[],d=0;d<c.length;d++)for(var b=c[d].Vertices,e=b.length,f=0;f<e;f++){var g=new a.VertexCopperlicht(this.mesh,c[d]);g.setVertex(b[f]);this.vertices.push(g)}this.faces=null;delete lookup};a.MeshCopperlicht.prototype.updateMeshPosition=function(a){this.mesh.Pos.X+=a.x;this.mesh.Pos.Y+=
a.y;this.mesh.Pos.Z+=a.z}})(MOD3);
